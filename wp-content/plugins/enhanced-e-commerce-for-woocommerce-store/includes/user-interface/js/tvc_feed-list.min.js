function tvc_fillFeedList() {
    var a = "";
    var b = jQuery("#tvc-feed-list");
    tvc_getFeedList(function (c) {
        var d = JSON.parse(c);
        var e = d.list;
        var f = d.special_feed_add_ons_active;
        if ("0" !== e) {
            a = tvc_feedListTable(e, f)
        } else {
            a = tvc_emptyListTable()
        }
        b.empty();
        b.append(a);
        console.log("Feed List refreshed");
        parent.location='admin.php?page=tvc-product-feed-manager&tab=feed-list';
    })
}

function appendCategoryLists(d, e, a) {
    var b = jQuery("#lvl_0");
    var c = jQuery("#category-selector-lvl");
    if (a) {
        tvc_getCategoryListsFromString(d, "", e, function (f) {
            var g = JSON.parse(f)[0];
            if (g && g.length > 0) {
                b.html(tvc_categorySelectCntrl(g));
                b.prop("disabled", false)
            } else {
                c.html(tvc_freeCategoryInputCntrl("default", "0", false));
                c.prop("disabled", false)
            }
        })
    }
}

function tvc_resetFeedList() {
    tvc_fillFeedList()
}

function tvc_resetFeedStatus(a) {
    tvc_checkNextFeedInQueue(function () {
        tvc_updateFeedRowStatus(a.product_feed_id, parseInt(a.status_id));
        tvc_updateFeedRowData(a)
    })
}

function tvc_feedListTable(g, j) {
    var h = "";
    if (!g) {
        return h
    }
    for (var e = 0; e < g.length; e++) {
        var c = g[e]["status"];
        var b = g[e]["product_feed_id"];
        var f = g[e]["url"];
        var a = "on_hold" === c || "ok" === c;
        var k = "";
        var d = tvc_list_status_text(c);
        if (a) {
            k = g[e]["products"]
        } else {
            if ("processing" === c) {
                k = tvc_feed_list_form_vars.processing_the_feed
            } else {
                if ("failed_processing" === c || "in_processing_queue" === c) {
                    k = tvc_feed_list_form_vars.unknown_text
                }
            }
        }
        h += '<tr id="feed-row"';
        if (e % 2 === 0) {
            h += ' class="alternate"'
        }
        h += ">";
        h += '<td id="title">' + g[e]["title"] + "</td>";
        h += '<td id="url">' + f + "</td>";
        h += '<td id="updated-' + b + '">' + g[e]["updated"] + "</td>";
        h += '<td id="products-' + b + '">' + k + "</td>";
        h += j ? '<td id="type-' + b + '">' + g[e]["feed_type_name"] + "</td>" : "";
        h += '<td id="feed-status-' + b + '" value="' + c + '" style="color: ' + g[e]["color"] + '"><strong>';
        h += d;
        h += "</strong></td>";
        h += '<td id="actions-' + b + '">';
        if (a) {
            h += feedReadyActions(b, f, c, g[e]["title"], g[e]["feed_type_name"])
        } else {
            h += feedNotReadyActions(b, f, g[e]["title"], g[e]["feed_type_name"])
        }
        h += "</td>"
    }
    return h
}

function feedReadyActions(b, f, e, k, j) {
    var h = "No feed generated" !== f;
    var c = f.lastIndexOf("/") > 0 ? f.slice(f.lastIndexOf("/") - f.length + 1) : k;
    var d = j.replace(/ /g, "-").toLowerCase();
    var a = k.replace(/ /g, "-").toLowerCase();
    var g = "ok" === e ? tvc_feed_list_form_vars.list_deactivate : tvc_feed_list_form_vars.list_activate;
    var i = '<strong><a href="javascript:void(0);" id="tvc-edit-' + a + '-action" onclick="parent.location=\'admin.php?page=tvc-product-feed-manager&tab=' + d + "&id=" + b + "'\">" + tvc_feed_list_form_vars.list_edit + " </a>";
    i += h ? ' | <a href="javascript:void(0);" id="tvc-view-' + a + '-action" onclick="tvc_viewFeed(\'' + f + "')\">" + tvc_feed_list_form_vars.list_view + "</a>" : "";
    i += ' | <a href="javascript:void(0);" id="tvc-delete-' + a + '-action" onclick="tvc_deleteSpecificFeed(' + b + ", '" + c + "')\">" + tvc_feed_list_form_vars.list_delete + "</a>";
    i += h ? '<a href="javascript:void(0);" id="tvc-deactivate-' + a + '-action" onclick="tvc_deactivateFeed(' + b + ')" id="feed-status-switch-' + b + '"> | ' + g + "</a>" : "";
    i += tvcEndOfActionsCode(b, a, j, k);
    return i
}

function feedNotReadyActions(b, h, e, a) {
    var g = h.lastIndexOf("/") > 0 ? h.slice(h.lastIndexOf("/") - h.length + 1) : e;
    var c = a.replace(/ /g, "-").toLowerCase();
    var f = e.replace(/ /g, "-").toLowerCase();
    var d = "<strong>";
    d += '<a href="javascript:void(0);" id="tvc-edit-' + f + '-action" onclick="parent.location=\'admin.php?page=tvc-product-feed-manager&tab=' + c + "&id=" + b + "'\">" + tvc_feed_list_form_vars.list_edit + "</a>";
    d += ' | <a href="javascript:void(0);" id="tvc-delete-' + f + '-action" onclick="tvc_deleteSpecificFeed(' + b + ", '" + g + "')\"> " + tvc_feed_list_form_vars.list_delete + "</a>";
    d += tvcEndOfActionsCode(b, f, a, e);
    d += tvc_addFeedStatusChecker(b);
    return d
}

function tvcEndOfActionsCode(b, e, a, d) {
    var c = ' | <a href="javascript:void(0);" id="tvc-duplicate-' + e + '-action" onclick="tvc_duplicateFeed(' + b + ", '" + d + "')\">" + tvc_feed_list_form_vars.list_duplicate + "</a>";
    c += "Product Feed" === a ? ' | <a href="javascript:void(0);" id="tvc-regenerate-' + e + '-action" onclick="tvc_regenerateFeed(' + b + ')">' + tvc_feed_list_form_vars.list_regenerate + "</a>" : "";
    c += "</strong>";
    return c
}

function tvc_emptyListTable() {
    var a = "";
    a += "<tr>";
    a += "<td colspan = 4>" + tvc_feed_list_form_vars.no_data_found + "</td>";
    a += "</tr>";
    return a
}

function tvc_updateFeedRowData(c) {
    if (c.status_id === "1" || c.status_id === "2") {
        var b = c.product_feed_id;
        var a = c.status_id === "1" ? tvc_feed_list_form_vars.ok : tvc_feed_list_form_vars.other;
        jQuery("#updated-" + b).html(c.updated);
        jQuery("#products-" + b).html(c.products);
        jQuery("#actions-" + b).html(feedReadyActions(b, c.url, a, c.title, c.feed_type_name))
    }
}

function tvc_switchStatusAction(b, a) {
    var d = jQuery("#title-" + b).html();
    var c = "";
    d = d.replace(/\s+/g, "-").toLowerCase();
    switch (a) {
        case"1":
            c = " | Auto-off ";
            break;
        case"2":
            c = " | Auto-on ";
            break
    }
    jQuery("#tvc-deactivate-" + d + "-action").html(c)
}

function tvc_list_status_text(a) {
    switch (a) {
        case"unknown":
            return tvc_feed_list_form_vars.unknown;
        case"ok":
            return tvc_feed_list_form_vars.status_ok;
        case"on_hold":
            return tvc_feed_list_form_vars.on_hold;
        case"processing":
            return tvc_feed_list_form_vars.processing;
        case"in_processing_queue":
            return tvc_feed_list_form_vars.processing_queue;
        case"has_errors":
            return tvc_feed_list_form_vars.has_errors;
        case"failed_processing":
            return tvc_feed_list_form_vars.failed_processing
    }
}

function tvc_updateFeedRowStatus(c, b) {
    var a = jQuery("#feed-status-" + c);
    var e = jQuery("#feed-status-switch-" + c);
    var d = jQuery("#products-" + c);
    switch (b) {
        case 0:
            a.html("<strong>" + tvc_feed_list_form_vars.unknown + "</strong>");
            a.css("color", "#6549F7");
            e.html("");
            break;
        case 1:
            a.html("<strong>" + tvc_feed_list_form_vars.ok + "</strong>");
            a.css("color", "#0073AA");
            e.html(" | " + tvc_feed_list_form_vars.list_deactivate + " ");
            break;
        case 2:
            a.html("<strong>" + tvc_feed_list_form_vars.on_hold + "</strong>");
            a.css("color", "#0173AA");
            e.html(" | " + tvc_feed_list_form_vars.list_activate + " ");
            break;
        case 3:
            a.html("<strong>" + tvc_feed_list_form_vars.processing + "</strong>");
            a.css("color", "#0000FF");
            e.html("");
            d.html(tvc_feed_list_form_vars.processing_the_feed);
            break;
        case 4:
            a.html("<strong>" + tvc_feed_list_form_vars.processing_queue + "</strong>");
            a.css("color", "#00CCFF");
            e.html(tvc_feed_list_form_vars.list_activate + " ");
            break;
        case 5:
            a.html("<strong>" + tvc_feed_list_form_vars.has_errors + "</strong>");
            a.css("color", "#FF0000");
            d.html(tvc_feed_list_form_vars.unknown);
            e.html(tvc_feed_list_form_vars.list_activate + " ");
            break;
        case 6:
            a.html("<strong>" + tvc_feed_list_form_vars.processing_failed + "</strong>");
            a.css("color", "#FF3300");
            d.html(tvc_feed_list_form_vars.unknown);
            e.html("");
            break
    }
}

jQuery(document).ready(function () {
});