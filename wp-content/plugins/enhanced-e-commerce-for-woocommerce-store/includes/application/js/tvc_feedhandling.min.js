var _feedHolder;

function tvc_getFeedAttributes(a, b, c) {
    tvc_getOutputFields(a, b, function (d) {
        if (d !== "0") {
            c(JSON.parse(d))
        } else {
            c([])
        }
    })
}

function tvc_customSourceFields(a, b) {
    tvc_getSourceFields(a, function (c) {
        b(c && c !== "0" ? JSON.parse(c) : "0")
    })
}

function tvc_mainFeedFilters(a, b) {
    tvc_getMainFeedFilters(a, function (c) {
        b(c !== "0" ? JSON.parse(c) : null)
    })
}

function tvc_addFeedAttributes(h, d, e) {
    var a = tvc_getAdvisedInputs(d);
    var c = 0;
    _feedHolder.clearAllAttributes();
    for (var g in h) {
        var b = h[g]["field_label"];
        var f = true;
        if (parseInt(h[g]["category_id"]) > 2 && h[g]["value"] === "") {
            f = false
        } else {
            if (h[g]["category_id"] === "0") {
                f = false
            } else {
                if (parseInt(h[g]["category_id"]) > 2 && h[g]["value"] === undefined) {
                    f = false
                }
            }
        }
        tvc_setChannelRelatedPresets(h[g], d);
        _feedHolder.addAttribute(c, b, a[b], h[g]["value"], h[g]["category_id"], f, 0, 0, 0);
        c++
    }
}

function tvc_saveFeedToDb(d, f) {
    _feedHolder = d;
    var c = jQuery("#tvc-ajax-feed-data-to-database-conversion-array").text();
    var a = tvc_getFeedDataToStore(c);
    var b = tvc_filterActiveMetaData(_feedHolder.attributes, _feedHolder.categoryMapping);
    var e = _feedHolder.feedFilter;
    tvc_updateFeedToDb(a, b, e, function (g) {
        f(g.trim())
    })
}

function tvc_filterActiveMetaData(b, d) {
    var a = [];
    for (var c = 0; c < b.length; c++) {
        if (b[c]["value"] !== undefined && b[c]["value"] !== "" && b[c]["isActive"] === true) {
            a.push(new Tvc_AttributeMeta(b[c]["fieldName"], b[c]["value"]))
        }
    }
    if (d.length > 0) {
        a.push(new Tvc_AttributeMeta("category_mapping", d))
    }
    return a
}

function tvc_getFeedDataToStore(e) {
    var b = JSON.parse(e);
    var a = [];
    for (var d = 0; d < b.length; d++) {
        var c = {
            name: b[d]["db"],
            value: undefined !== _feedHolder[b[d]["feed"]] ? _feedHolder[b[d]["feed"]] : "",
            type: b[d]["type"]
        };
        a.push(c)
    }
    return a
};