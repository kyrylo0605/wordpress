jQuery(function(c){"use strict";var t=c("select#product-type"),n=woocommerce_admin_meta_boxes.post_id,d={message:null,overlayCSS:{background:"#fff",opacity:.7}},a={attribute:"data-tip",fadeIn:50,fadeOut:50,delay:200},r={el:{add_item_btn:c("#yith-wcpb-add-bundled-product"),bundled_items:c("#yith_bundled_product_data .yith-wcpb-bundled-items"),items_count:c("#yith_bundled_product_data .yith-wcpb-bundled-items .yith-wcpb-bundled-item").size()+1,ajax_filter_products:null},init:function(){this.el.add_item_btn.on("click",this.select_products),c(document).on("click",".yith-wcpb-add-product",this.add_item),c(document).on("keyup","input.yith-wcpb-select-product-box__filter__search",this.search_filter),c(document).on("click",".yith-wcpb-remove-bundled-product-item",this.remove_current_item),c(document).on("click",".yith-wcpb-bundled-item h3 a",this.stop_event_propagation),c(document).on("click",".yith-wcpb-select-product-box__products__pagination .first:not(.disabled)",this.paginate),c(document).on("click",".yith-wcpb-select-product-box__products__pagination .prev:not(.disabled)",this.paginate),c(document).on("click",".yith-wcpb-select-product-box__products__pagination .next:not(.disabled)",this.paginate),c(document).on("click",".yith-wcpb-select-product-box__products__pagination .last:not(.disabled)",this.paginate),this.sorting()},add_item:function(){var t=c(this).closest("tr").find(".yith-wcpb-product-added"),e=c(this).data("id"),i=c(this).closest(".yith-wcpb-select-product-box__products");if(e){i.block(d);var o={action:"yith_wcpb_add_product_in_bundle",open_closed:"open",post_id:n,id:r.el.items_count,product_id:e};c.ajax({type:"POST",url:ajaxurl,data:o,success:function(t){t.error?alert(t.error):t.html&&(r.el.bundled_items.append(t.html),r.el.bundled_items.find(".help_tip, .woocommerce-help-tip").tipTip(a),c("body").trigger("wc-enhanced-select-init"),r.el.items_count++)},complete:function(){i.unblock(),t.fadeIn().delay(1e3).fadeOut()}})}},remove_current_item:function(){c(this).parent().parent().remove()},filter_products:function(t){t.s!==undefined&&t.s.length<3&&(t.s=""),t=c.extend(t,{action:"yith_wcpb_select_product_box_filtered"});var i=c(".yith-wcpb-select-product-box__products");i.block(d),r.el.ajax_filter_products&&r.el.ajax_filter_products.abort(),r.el.ajax_filter_products=c.ajax({type:"POST",url:ajaxurl,data:t,success:function(t){i.html(t)},complete:function(t,e){"abort"!==e&&i.unblock(d)}})},paginate:function(){var t=c(this).data("page");if(t!==undefined){var e=c("input.yith-wcpb-select-product-box__filter__search").val();r.filter_products({s:e,page:t})}},search_filter:function(){var t=c(this).val();(!t||3<=t.length)&&r.filter_products({s:t})},select_products:function(){c.fn.yith_wcpb_popup({ajax:!0,url:ajaxurl,ajax_data:{action:"yith_wcpb_select_product_box"},ajax_success:function(){c(".yith-wcpb-select-product-box__filter__search").focus()}})},sorting:function(){var t=this.el.bundled_items.find(".yith-wcpb-bundled-item").get();t.sort(function(t,e){var i=parseInt(c(t).attr("rel")),o=parseInt(c(e).attr("rel"));return i<o?-1:o<i?1:0}),c(t).each(function(t,e){r.el.bundled_items.append(e)}),this.el.bundled_items.sortable({items:".yith-wcpb-bundled-item",cursor:"move",axis:"y",handle:"h3",scrollSensitivity:40,forcePlaceholderSize:!0,helper:"clone",opacity:.65,placeholder:"wc-metabox-sortable-placeholder",start:function(t,e){e.item.css("background-color","#f6f6f6")},stop:function(t,e){e.item.removeAttr("style")}})},stop_event_propagation:function(t){t.stopPropagation()}};r.init(),c("body").on("woocommerce-product-type-change",function(t,e,i){"yith_bundle"===e?(c(".pricing").show(),c(".product_data_tabs").find("li.general_options").show(),c(".show_if_external").hide(),c(".show_if_simple").show(),c(".show_if_bundle").show(),c("input#_downloadable").prop("checked",!1).closest(".show_if_simple").hide(),c("input#_virtual").removeAttr("checked").closest(".show_if_simple").hide(),c("input#_manage_stock").change(),c(".hide_if_bundle").hide(),c('a[href="#yith_bundled_product_data"]').click()):(c(".show_if_bundle").hide(),c(".hide_if_bundle").show())}),t.change()});